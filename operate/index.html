<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from src/site/xdoc/operate/index.xml.vm at 2023-10-27
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <meta name="author" content="Paul Ramirez" />
    <meta name="author" content="Jordan Padams" />
    <meta name="author" content="Sean Hardman" />
    <title>Registry &#x2013; Operation</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.8.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="https://github.com/NASA-PDS-Incubator/registry" id="bannerLeft"><img src="../images/pds4_logo.png"  alt=""/></a></div>
          <div class="pull-right"><div id="bannerRight"><h2>PDS Registry</h2>
</div>
</div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2023-10-27<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.3.5</li>
      <li class="pull-right"><a href="https://github.com/NASA-PDS-Incubator/registry" class="externalLink" title="Registry Github Repo">Registry Github Repo</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Software Documentation</li>
    <li><a href="../index.html" title="About PDS Registry"><span class="none"></span>About PDS Registry</a></li>
    <li><a href="../install/index.html" title="Installation"><span class="none"></span>Installation</a></li>
    <li class="active"><a href="#"><span class="none"></span>Operation</a></li>
   <li class="nav-header">Downloads</li>
    <li><a href="https://github.com/NASA-PDS-Incubator/registry-mgr-legacy/releases/download/v2.3.5/registry-mgr-legacy-2.3.5-bin.tar.gz" class="externalLink" title="Current Release (tar.gz)"><span class="none"></span>Current Release (tar.gz)</a></li>
    <li><a href="https://github.com/NASA-PDS-Incubator/registry-mgr-legacy/releases/download/v2.3.5/registry-mgr-legacy-2.3.5-bin.zip" class="externalLink" title="Current Release (zip)"><span class="none"></span>Current Release (zip)</a></li>
    <li><a href="https://pds-engineering.jpl.nasa.gov/content/pds4-software" class="externalLink" title="Past Releases"><span class="none"></span>Past Releases</a></li>
   <li class="nav-header">Change Log</li>
    <li><a href="https://github.com/NASA-PDS-Incubator/registry-mgr-legacy/blob/v2.3.5/CHANGELOG.md#v2.3.5" class="externalLink" title="Since v2.1.0"><span class="none"></span>Since v2.1.0</a></li>
    <li><a href="../changes-report.html" title="Prior to v2.1.0"><span class="none"></span>Prior to v2.1.0</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >

  
    <section>
<h2><a name="Operation"></a>Operation</h2>
      
<p>The Registry is an Apache Solr adaptation that includes the Solr Admin interface along with the pre-installed collections that come with the PDS Registry and Search.  Once it is deployed, operations include modifying the configuration and leveraging the PDS and PDAP protocols to query data and metadata that has been extracted from PDS4 data products. The following topics will be covered below:
      </p>
      
<ul>
        
<li><a href="#Tools">Tools to Interact with the Registry</a>
        
<ul>
          
<li><a href="#Solr_Admin_Interface">Solr Admin Interface</a></li>
          
<li><a href="#Registry_Manager_Tool">Registry Manager Tool</a></li>
        </ul>
        </li>
        
<li><a href="#Registry_Solr_Collections">Registry Solr Collections</a>
          
<ul>
            
<li><a href="#Registry_Collection">Registry Collection</a></li>
            
<li><a href="#XPath_Collection">XPath Collection</a></li>
            
<li><a href="#Data_Collection">Metadata Search Collection</a></li>
          </ul>
        </li>
      	
<li><a href="#Common_Operations">Common Operations</a>
      	
<ul>
      	  
<li><a href="#Add_Data_To_Registry_and_Search">Add Data To Registry and Search</a></li>
      	  
<li><a href="#Delete_Data_From_Registry_and_Search">Delete Data From Registry and Search</a></li>
      	  
<li><a href="#Re-Ingest_Data_To_Registry_and_Search">Re-Ingest Data To Registry and Search</a></li>
      	</ul>
      	</li>
        
<li><a href="#Configuration">Configuration</a></li>
      	
<ul>
      	  
<li><a href="#Add_A_Facet">Add A Facet</a></li>
      	  
<li><a href="#Update_Output_Format">Update Output Format</a></li>
      	  
<li><a href="#Add_a_Field_to_the_Schema">Add a Field to the Schema</a></li>
      	  
<li><a href="#Create_New_Search_Endpoint">Create New Search Endpoint</a></li>
      	</ul>
        
<li><a href="#Search_Protocols">Search Protocols</a></li>
        
<li><a href="#Common_Errors">Common Errors</a></li>
      </ul>
    </section>

    <hr />
    <section>
<h2><a name="Tools"></a>Tools</h2>
      <section>
<h3><a name="Solr_Admin_Interface"></a>Solr Admin Interface</h3>
        
<p>The Solr Administration Interface is available for advanced configuration and debugging of the Solr instance. The page can be viewed at <i>http://localhost:8983/solr</i> or if you have setup the proxy pass as directed in the installation guide, <i>https://&lt;hostname&gt;:8983/services/registry</i>. The following resources are available detailing the how to use this interface:
        </p>
        
        
<ul>
          
<li><a class="externalLink" href="https://lucene.apache.org/solr/guide/8_2/overview-of-the-solr-admin-ui.html" target="_blank">Overview of the Solr Admin UI</a>
          </li>
          
<li><a class="externalLink" href="https://lucene.apache.org/solr/guide/8_2/using-the-solr-administration-user-interface.html" target="_blank">Using the Solr Administration User Interface</a>
          </li>
        </ul>
        
        
<p>From the query page, you can perform various queries against the available end points supported by the services. See <i>registry/collections/*/solrconfig.xml</i> for the different possible endpoints. Details regarding the supported query parameters can be found on the <a class="externalLink" href="http://wiki.apache.org/solr/CommonQueryParameters" target="_blank">Common Query Parameters</a> page of the Solr wiki.
        </p>
      </section>
      
      <section>
<h3><a name="Registry_Manager_Tool"></a>Registry Manager Tool</h3>
        
<p>
          This utility currently on wraps the <a class="externalLink" href="https://lucene.apache.org/solr/guide/8_2/post-tool.html">Solr Post Tool</a> to post and delete data from the PDS Registry collections. Future improvements to this tool 
          may allow for more extensive interaction with the Registry from the command-line.
        </p>
        
<p>
          Current functionality includes:
          </p>
<ul>
            
<li>Post Harvest-generated Solr Documents to the searchable 'data' collection</li>
            
<li>Delete individual Registry packages (aka Harvest runs) from Registry collections</li>
            
<li>Delete all documents from all collections.</li>
          </ul>
        

        <section>
<h4><a name="Usage"></a>Usage</h4>
        
<div class="source"><pre class="prettyprint">
$ ./registry-mgr -h

Usage: ./registry-mgr [OPTIONS] [SOLR-DOCS]

Options:
  -h                              Print Help
  -host &lt;host&gt;                    Solr server host (default: localhost)
  -port &lt;port&gt;                    Solr server port (default: 8983)
  -delete-pkg &lt;package_id&gt;        Delete a specific Harvest ingestion package
  -delete-all                     Delete all data from all Registry collections

Optional Parameters:
  SOLR-DOCS     solr-docs directory or an xml file
        </pre></div>

      </section></section>
    </section>

    <hr />
    <section>
<h2><a name="Registry_Solr_Collections"></a>Registry Solr Collections</h2>
      <section>
<h3><a name="Registry_Collection"></a>Registry Collection</h3>
        
<p><b>Endpoint:</b> <a class="externalLink" href="http://localhost:8983/solr/registry/">http://localhost:8983/solr/registry/</a> (replace host/port as needed)</p>
        
        
<p><b>Description: </b>The Registry collection is used as the base blob store for all PDS product labels. It includes some basic metadata about the product label, 
          like the MD5 checksum, Registry Package ID (the unique identifier for each Harvest run), etc., with plans to expand this collection to include 
          more important archival metadata.
        </p>
      </section>
        
      <section>
<h3><a name="XPath_Collection"></a>XPath Collection</h3>
        
<p><b>Endpoint:</b> <a class="externalLink" href="http://localhost:8983/solr/xpath/">http://localhost:8983/solr/xpath/</a> (replace host/port as needed)</p>
        
        
<p><b>Description: </b>The XPath collection is used as a quick-look of the label metadata ingested into the Registry Collection. It is a nice 
          way to have a look at the data in your archive, as a well as a means for informing how you may want to augment your <a href="#Data_Collection">'data' collection</a>.
        </p>
      </section>
      
      <section>
<h3><a name="Data_Collection"></a>Data Collection</h3>
        
<p><b>Endpoint:</b> <a class="externalLink" href="http://localhost:8983/solr/data/">http://localhost:8983/solr/data/</a> (replace host/port as needed)</p>
        
        
<p><b>Description: </b>The Data collection is intended to be the more search-friendly metadata store. It is used to refine the &quot;kitchen sink&quot;
          of metadata in all of the labels, into a refined set of search fields that will enable a more accurate, usable search capability. This collection 
          will eventually be utilized by the PDS Search API efforts to provide an integrated approach to metadata search across the PDS.
        </p>
      </section>
      
    </section>

    <hr />
    <section>
<h2><a name="Common_Operations"></a>Common Operations</h2>
      
<p>Here are some common operations you may wish to perform to interact with the Registry and Search. 
A tool to simplify these actions is in the plan, but in the meantime, here are the various raw commands you can do 
to modify data in your registry and search. 
For additional information for interacting with the Registry, please also take a look at 
the <a class="externalLink" href="https://lucene.apache.org/solr/guide/8_2/collections-api.html">Solr Collections API</a> and other info 
on <a class="externalLink" href="https://lucene.apache.org/solr/guide/8_2/overview-of-documents-fields-and-schema-design.html">interacting with Solr documents</a>.
</p>

      <section>
<h3><a name="Add_Data_To_Registry_and_Search"></a>Add Data To Registry and Search</h3>
        
<p>Run <a class="externalLink" href="https://pds-engineering.jpl.nasa.gov/development/pds4/current/harvest/">the Harvest Tool</a> to populate the Registry with data.
        </p>
        
        
<p>When you run the Harvest Tool, basic metadata to capture archive information will be ingested into the Registry.</p>
           
        
<p>After you have run the Harvest Tool you should see one or more files like <i>solr_doc_0.xml</i>, <i>solr_doc_1.xml</i>
under <i>/path/to/registry/../registry-data/solr-docs</i> (or on Windows C:\\path\to\registry\..\registry-data\solr-docs).
        </p>
        
        
<p>These files are needed to populate the <i>data</i> Solr collection, which will provide a more refined, custom indexing strategy to
          PDS product metadata, allowing it to be more easily searchable and leverage the PDS Search APIs. To ingest these files into Solr,
          execute the following command from either <i>/path/to/harvest/bin</i> or <i>/path/to/registry/bin</i>:
        </p>
        
<div class="source"><pre class="prettyprint">
# Post Harvest solr-docs to http://localhost:8983 by default
% ./registry-mgr /path/to/registry/../registry-data/solr-docs

# Post Harvest solr-docs to a Solr instance on a different host and port
% ./registry-mgr -h example.com -p 9000 /path/to/registry/../registry-data/solr-docs

        </pre></div>
        
        
<p><i>Note: This only works in a POSIX-compatible environment. For Windows users that cannot support a POSIX-compatible environment, 
        you can execute curl commands on each solr-docs/solr_doc_*.xml file like:</i>
        </p>
<div class="source"><pre class="prettyprint">
$ curl 'http://localhost:8983/solr/data/update/' --data-binary @C:\\path\to\solr-docs\solr_doc_0.xml
        </pre></div>
        
    </section>

	  <section>
<h3><a name="Delete_Data_From_Registry_and_Search"></a>Delete Data From Registry and Search</h3>
	    
<p>Once you have data in the Registry and/or Search, you can delete data from the Registry collections 
        using the following:
	    </p>

	    
<p>Using <a href="#Registry_Manager_Tool">Registry Manager Tool</a>:
	      </p>
<div class="source"><pre class="prettyprint">
# Delete a specific Registry Package (aka Harvest run) from all collections
./registry-mgr -delete-pkg 86037219-aa7d-4a70-a239-4501e0c675a4

# Delete all data from all collections
./registry-mgr -delete-all  
	      </pre></div>
	    
	    
	    
<p>Using <a class="externalLink" href="https://curl.haxx.se/">curl</a> (update host/port and as needed):
	      </p>
<div class="source"><pre class="prettyprint">
# Delete a specific Registry Package (aka Harvest run) from all collections
$ curl 'http://localhost:8983/solr/registry/update/' --data-binary &quot;&lt;delete&gt;&lt;query&gt;package_id:86037219-aa7d-4a70-a239-4501e0c675a4&lt;/query&gt;&lt;/delete&gt;&quot;
$ curl 'http://localhost:8983/solr/xpath/update/' --data-binary &quot;&lt;delete&gt;&lt;query&gt;package_id:86037219-aa7d-4a70-a239-4501e0c675a4&lt;/query&gt;&lt;/delete&gt;&quot;
$ curl 'http://localhost:8983/solr/data/update/' --data-binary &quot;&lt;delete&gt;&lt;query&gt;package_id:86037219-aa7d-4a70-a239-4501e0c675a4&lt;/query&gt;&lt;/delete&gt;&quot;

# Delete all data from all collections
$ curl 'http://localhost:8983/solr/registry/update/' --data-binary &quot;&lt;delete&gt;&lt;query&gt;*:*&lt;/query&gt;&lt;/delete&gt;&quot;
$ curl 'http://localhost:8983/solr/xpath/update/' --data-binary &quot;&lt;delete&gt;&lt;query&gt;*:*&lt;/query&gt;&lt;/delete&gt;&quot;
$ curl 'http://localhost:8983/solr/data/update/' --data-binary &quot;&lt;delete&gt;&lt;query&gt;*:*&lt;/query&gt;&lt;/delete&gt;&quot;
	      </pre></div>
	    
	  </section>
	  <section>
<h3><a name="Re-Ingest_Data_To_Registry_and_Search"></a>Re-Ingest Data To Registry and Search</h3>
	    
<ul>
	      
<li><a href="#Delete_Data_From_Registry_and_Search">Delete</a> the data you would like to remove from Registry and Search.</li>
	      
<li>If you removed data from both the Registry and Search, you will need to re-run Harvest and then <a href="#Add_Data_To_Registry_and_Search">re-ingest the data</a> into the Search index.</li>
	      
<li>If you only removed data from the Search index, you can then just <a href="#Add_Data_To_Registry_and_Search">re-ingest the data</a> into the Search index.</li>
	    </ul>
	  </section>
    </section>

    <section>
<h2><a name="Configuration"></a>Configuration</h2>
      
<p>The Registry comes preconfigured for supporting common PDS search terms and facets. That said, it can be tailored to support Discipline Node specific search requirements. See the <a class="externalLink" href="http://lucene.apache.org/solr/" target="_blank">Apache Solr website</a> and <a class="externalLink" href="http://wiki.apache.org/solr/" target="_blank">wiki</a> for more information on configuring Apache Solr. The sub-sections that follow detail the steps for performing some common configuration changes.
      </p>

      <section>
<h3><a name="Add_a_Field_to_the_Schema"></a>Add a Field to the Schema</h3>
        
<p>In order to add a field to the schema, modify the <i>$REGISTRY_HOME/conf/schema.xml</i> file. The following example will add the field <i>my_field</i>:
        </p>

        
<div class="source"><pre class="prettyprint">
&lt;field name=&quot;my_field&quot; type=&quot;text_general&quot; indexed=&quot;true&quot; stored=&quot;false&quot; \
multiValued=&quot;false&quot; /&gt;
        </pre></div>

        
<p>See the <a class="externalLink" href="http://wiki.apache.org/solr/SchemaXml" target="_blank">Schema XML</a> page of the Solr wiki for more information on update the Solr schema.
        </p>
      </section>
    </section>

    <hr />
    <section>
<h2><a name="Search_Protocols"></a>Search Protocols</h2>
      
<p>The Registry provides two protocols for searching the contents of the service.
      </p>

      <section>
<h3><a name="PDS_Search_Protocol"></a>PDS Search Protocol</h3>
        
<p>See the <a href="../../docs/pds4_pds_search_protocol.pdf">PDS Search Protocol</a> document for more information on search terms and result formatting provided by this protocol. If viewing this document from the registry-mgr-legacy package, view the <a class="externalLink" href="https://pds-engineering.jpl.nasa.gov/development/pds4/current/search/docs/pds4_pds_search_protocol.pdf" target="_blank">PDS Search Protocol</a> document from the Engineering Node site.
        </p>
      </section>

      <section>
<h3><a name="PDAP_Protocol"></a>PDAP Protocol</h3>
        
<p>See the <a href="../../docs/pds4_pdap_search_protocol.pdf">PDAP Search Protocol</a> document for more information on search terms and result formatting provided by this protocol. If viewing this document from the registry-mgr-legacy package, view the <a class="externalLink" href="https://pds-engineering.jpl.nasa.gov/development/pds4/current/search/docs/pds4_pdap_search_protocol.pdf" target="_blank">PDAP Search Protocol</a> document from the Engineering Node site.
        </p>
      </section>
    </section>

    <hr />
    <section>
<h2><a name="Common_Errors"></a>Common Errors</h2>
      TBD
    </section>
  

        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &#169;      2023<a href="https://pds.nasa.gov/">Planetary Data System</a>.
.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
